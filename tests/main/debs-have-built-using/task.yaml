summary: Ensure that our debs have the "built-using" header

systems: [-ubuntu-core-*, -fedora-*, -opensuse-*, -arch-*]

execute: |
    out=$(dpkg -I "$GOHOME"/snapd_*.deb)
    if [[ "$SPREAD_SYSTEM" = ubuntu-* ]]; then
        # Apparmor & seccomp is only compiled in on Ubuntu for now.
        #shellcheck disable=SC1117
        echo "$out" | MATCH "Built-Using:.*apparmor \(="
        #shellcheck disable=SC1117
        echo "$out" | MATCH "Built-Using:.*libseccomp \(="
    fi
    #shellcheck disable=SC1117
    echo "$out" | MATCH "Built-Using:.*libcap2 \(="
